<html>

<head>
  <meta charset="utf-8">
  <title>CartLab File Uploader</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
<style>
input.invalid, textarea.invalid{
  border: 2px solid red;
}

input.valid, textarea.valid{
  border: 2px solid green;
}

input.check,{
  border: 2px solid orange;
}

.error{
display: none;
margin-left: 10px;
}

.error_show{
color: red;
margin-left: 10px;
}
.beta{
  font-size: 50%;
  font-weight: 300;
}
#file-error{
  color: red;
}
#indexLink{
  float:right;
}

.form-label {
    margin-left: 5px;
}

.author-row, .ref-row {
  padding-top: 10px;
}

.resource-type li {
  display: block;
}

.changefields {
  width: 100%;
}

footer{
  text-align: center;
}
</style>
</head>
<body>
  <nav class="navbar navbar-right">
  <div class="container-fluid">
    <ul class="nav navbar-nav">
      <li><a href="index.html">Home</a></li>
      <li><a href="production.html">Production</a></li>
      <li class="active"><a href="research.html">Research</a></li>
      <li><a href="education.html">Education</a></li>
      <li><a href="search.html">Search</a></li>
    </ul>
  </div>
</nav>

<div id='main' class='container col-xs-offset-2 col-xs-8'>
  <h1 class='page-header'>
    UWCL Resource Uploading Form <span class='text-success'><i class='beta'>beta</i></span>
  </h1>
  <div id='the-resource'>
    <h2 class='page-header'>The Resource</h2>
      
    <!-- File upload or link text input -->
    <div class='col-xs-5'>
      <label>File</label>
      <input id='fileUpload' type='file' /><i class='invalid' id='file-error' style='display:none'>File Type Not Allowed</i><br / />
    </div>
    <div class='col-xs-2'>
      OR
    </div>
    <div class='col-xs-5'>
      <label>Link</label>
      <input type='text' id='link' name='link' placeholder='http://myawesomewebsite.com/myproject' class='form-control' /><br/>
    </div>

  </div> <!-- end of The Resource div -->

  <div id='the-metadata'>
    <h2 class='page-header'>The Metadata</h2>

    <!-- Category dropdown -->
    <h4>Category</h4>
    <select id='resourceCategory' class='form-control'></select><br />

    <!-- Type radio list -->
    <div id='col-xs-12'>
      <h4>Type of Resource</h4>
      <span class='type-placeholder' style="color: #f00;">Select a category above</span>
      <ul class='resource-type' style="display: none;">
        <!-- Research options -->
        <li class='Research'>
          <input type='radio' name='resourcetype' value='journal' />
          <label class='form-label'>Journal Article</label>
        </li><li class='Research'>
          <input type='radio' name='resourcetype' value='chapter' />
          <label class='form-label'>Book Section</label>
        </li><li class='Research'>
          <input type='radio' name='resourcetype' value='conference' />
          <label class='form-label'>Conference Proceedings</label>
        </li><li class='Research'>
          <input type='radio' name='resourcetype' value='slides' />
          <label class='form-label'>Conference Presentation (slides)</label>
        </li><li class='Research'>
          <input type='radio' name='resourcetype' value='poster' />
          <label class='form-label'>Conference Poster</label>
        </li><li class='Research'>
          <input type='radio' name='resourcetype' value='thesis' />
          <label class='form-label'>Thesis or Dissertation</label>
        </li><li class='Research'>
          <input type='radio' name='resourcetype' value='research-other' />
          <label class='form-label'>Other:</label>
          <input type='text' name='research-other'>
        </li>
        <!-- Education options -->
        <li class='Education'>
          <input type='radio' name='resourcetype' value='project' />
          <label class='form-label'>Final Project</label>
        </li><li class='Education'>
          <input type='radio' name='resourcetype' value='tutorial' />
          <label class='form-label'>Tutorial</label>
        </li><li class='Education'>
          <input type='radio' name='resourcetype' value='education-other' />
          <label class='form-label'>Other:</label>
          <input type='text' name='education-other'>
        </li>
        <!-- Production options -->
        <li class='Production'>
          <input type='radio' name='resourcetype' value='map' />
          <label class='form-label'>Map</label>
        </li><li class='Production'>
          <input type='radio' name='resourcetype' value='interactive' />
          <label class='form-label'>Interactive</label>
        </li><li class='Production'>
          <input type='radio' name='resourcetype' value='video'/>
          <label class='form-label'>Video Demonstration</label>
        </li><li class='Production'>
          <input type='radio' name='resourcetype' value='dataset' />
          <label class='form-label'>Dataset</label>
        </li><li class='Production'>
          <input type='radio' name='resourcetype' value='production-other' />
          <label class='form-label'>Other:</label>
          <input type='text' name='production-other'>
        </li>
        <!-- Map Chat options -->
        <li class='Map-Chat'>
          <input type='radio' name='resourcetype' value='blog' />
          <label class='form-label'>Blog Post</label>
        </li><li class='Map-Chat'>
          <input type='radio' name='resourcetype' value='news' />
          <label class='form-label'>News</label>
        </li><li class='Map-Chat'>
          <input type='radio' name='resourcetype' value='map-chat-other' />
          <label class='form-label'>Other:</label>
          <input type='text' name='map-chat-other'>
        </li>
      </ul>
    </div><br/>

    <!-- Short Title text field -->
    <h4>Short Title</h4>
    <label><span class='text-muted typechange shorttitlelabel'></span></label>
    <input type='text' id='resourceID' name='resourceID' class='form-control'/><br />
    
    <!-- Full Title text field -->
    <h4 class="typechange fulltitleheader">Full Title</h4>
    <label><span class='text-muted'>Complete document title only; No author, year, outlet, etc.</span></label>
    <input type='text' id='resourceName' name='resourceName' class='form-control' placeholder="Title of the resource"/><br />

    <!-- Tags text area -->
    <h4>Tags</h4>
    <label><span class='text-muted'>Provide a comma-separated list</span></label>
    <textarea id='tags' name='tags' placeholder="tag1, tag2, tag3..." class='form-control'></textarea><br />

    <!-- Authors -->
    <h4>Authors
      <button id='addAuthor' class='btn btn-success btn-sm'><span class='glyphicon glyphicon-plus'></span></button>
      <button id='removeAuthor' class='btn btn-alert btn-sm'><span class='glyphicon glyphicon-minus'></span></button>
    </h4>
    <label><span class='text-muted'>Full first name, middle initial(s), full last name</span></label>

    <!-- authors container div -->
    <div id='authors'>
      <div id='authorRow1'>
        <label>First Author: </label>
        <input type='text' id='authorFirst' class='authorFirst form-control' placeholder='Buck' />
        <input type='text' id='authorMiddle' class='authorMiddle form-control' placeholder="E." />
        <input type='text' id='authorLast' class='authorLast form-control' placeholder="Badger" />
      </div>
    </div><br/>

    <!-- Description paragraph input -->
    <h4>General Description</h4>
    <textarea id='resourceDesc' placeholder='Describe the resource' class='form-control' ></textarea><br />

    <!-- Publication Date field -->
    <h4 class='typechange dateheader'>Date</h4>
    <label><span class='text-muted'>If no date is supplied, work will be tagged with today's date</span></label>
    <input type='date' id='publicationDate' name='publicationDate' class='form-control' placeholder='DD/MM/YYYY' /><br />
    
    <span class="changefields Research">
      <!-- Outlet text field -->
      <h4 class="typechange outletheader">Publication Outlet</h4>
      <label><span class='text-muted typechange outletlabel'></span></label>
      <input type='text' id='outlet' name='outlet' class='form-control'/><br />

      <!-- Volume text field -->
      <h4>Volume</h4>
      <input type='text' id='volume' name='volume' class='form-control' placeholder="1"/><br />

      <!-- Issue text field -->
      <h4>Issue</h4>
      <input type='text' id='issue' name='issue' class='form-control' placeholder="1"/><br />

      <!-- Pages text field -->
      <h4>Pages</h4>
      <input type='text' id='pages' name='pages' class='form-control' placeholder="1-10"/><br />

      <!-- Conference Location text field -->
      <h4>Conference Location</h4>
      <input type='text' id='location' name='location' class='form-control' placeholder="Madison, WI, USA"/><br />

      <!-- DOI text field -->
      <h4>DOI</h4>
      <input type='text' id='doi' name='doi' class='form-control' placeholder="Include full link, e.g., http://dx.doi.org/10.1234/56789012.2017.3456789"/><br />

      <!-- External URL text field -->
      <h4>External URL</h4>
      <input type='text' id='url' name='url' class='form-control' placeholder="Only use if resource is being uploaded as a file"/><br />
    </span>

    <span class="changefields Production">
      <!-- Data Sources text area -->
      <h4>Data Sources</h4>
      <textarea id='sources' class="form-control" placeholder="Describe the data sources used"/></textarea><br />

      <!-- Data Quality text area -->
      <h4>Data Quality</h4>
      <textarea id='quality' class="form-control" placeholder="Describe the accuracy, completeness, consistency, and lineage of the data used, including creation dates"/></textarea><br />

      <!-- Spatial Data Organization text area -->
      <h4>Spatial Data Organization</h4>
      <textarea id='organization' class="form-control" placeholder="For datasets, describe whether the data is raster, vector, or 3D and the types and numbers of elements"/></textarea><br />

      <!-- Spatial Reference text area -->
      <h4>Spatial Reference</h4>
      <textarea id='reference' class="form-control" placeholder="Describe the projection, grid system, datum, and/or coordinate system"/></textarea><br />

      <!-- Feature and Attribute Information text area -->
      <h4>Feature and Attribute Information</h4>
      <textarea id='attributes' class="form-control" placeholder="Describe the number and types of features and the included attributes and value ranges"/></textarea><br />

      <!-- Distribution Information text area -->
      <h4>Distribution Information</h4>
      <textarea id='distribution' class="form-control" placeholder="Describe the formats and media in which the product is distributed, including any relevant URLs"/></textarea><br />
    </span>

    <span class="changefields Education">
      <!-- Completion Date input -->
      <h4>Completion Date</h4>
      <input type='date' id='completionDate' name='completionDate' class='form-control' placeholder='1-1-2017'/><br />

      <!-- Course Abbreviation text input -->
      <h4>Course Abbreviation</h4>
      <input type='text' id='courseAbbr' name='courseAbbr' class='form-control' placeholder='GEOG 572' /><br />

      <!-- Course Name text input -->
      <h4>Course Name</h4>
      <input type='text' id='courseName' name='courseName' class='form-control' placeholder='Graphic Design in Cartography' /><br />
    </span>

  </div> <!-- end of The Metadata div -->

  <!-- The Uploader div -->
  <div id='the-uploader'>
    <h2 class='page-header'>The Uploader</h4>
    <label>Uploader Name</label>
    <input type='text' class='form-control' id='uploaderName' placeholder="Your Name" /><br / />
    <label>Uploader Email</label>
    <input type='text' id='uploaderEmail' class='form-control' placeholder='you@wisc.edu' />
  </div> <!-- end of The Uploader div -->


  <button id='submit' class='btn btn-primary btn-large'>Submit Form</button>
</div>
<footer class='col-xs-12'>
  <address>
Cartography Laboratory<br />
University of Wisconsin-Madison<br />
Madison, Wisconsin<br>
USA
</address>

</footer>
<script   src="https://code.jquery.com/jquery-2.2.4.js"   integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="   crossorigin="anonymous"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <script>
  globals = {}
  globals.hosts = {
    categories : "https://cartlabserver.shc.wisc.edu:8443/categories",
    search : "https://cartlabserver.shc.wisc.edu:8443/search",
    post : "https://cartlabserver.shc.wisc.edu:8443/upload",
    mediaTypes : "https://cartlabserver.shc.wisc.edu:8443/mediatypes",
    upload : "https://cartlabserver.shc.wisc.edu:8443/upload"
  }
  globals.authorCount = 1;
  globals.refCount = 1;
  $(document).ready(function(){
    getAllowedMediaTypes(); // gets the list of media types
    getCategories(true); // gets the categories list and populates the dropdown
    setDate()
    //actions
    $("#submit").click(function(){
      submit()
    })
    $("#addAuthor").click(function(){
      //add another set of author fields
      globals.authorCount += 1
      var html = "<div id='authorRow" + globals.authorCount + "' class='author-row'><label>Author " + globals.authorCount + ": </label><input type='text' id='authorFirst" + globals.authorCount + "' class='authorFirst form-control' placeholder='Buck' /><input type='text' id='authorMiddle" + globals.authorCount + "' class='authorMiddle form-control' placeholder='E.'' /> <input type='text' id='authorLast" + globals.authorCount + "' class='authorLast form-control' placeholder='Badger' />"
      $("#authors").append(html)
    })
    $("#removeAuthor").click(function(){
      //remove the author row if there are more than one on screen
      tag = "#authorRow" + globals.authorCount
      if (globals.authorCount > 1){
        $(tag).remove()
        globals.authorCount -= 1
      }
    })
    $("#addReference").click(function(){
      //add another reference field
      globals.refCount += 1;
      var html = "<div id='refRow" + globals.refCount + "' class='ref-row'><label>Published Reference " + globals.refCount + "</label><input type='text' id='ref" + globals.refCount + "' class='form-control'/></div>"
      $("#refs").append(html)
    })
    $("#removeReference").click(function(){
      tag = "#refRow" + globals.refCount
      if (globals.refCount > 1){
        $(tag).remove()
        globals.refCount -=1
      }
    })
  })

  function submit(){
    //get the form values
    var resourceID = $("#resourceID").val().replace(/ |'|"/g, '_')
    var resourceName = $("#resourceName").val()
    //get the first author, (required)
    var firstAuthor = {
      'first' : $("#authorFirst").val(),
      'middle' : $("#authorMiddle").val(),
      'last' : $("#authorLast").val()
    }
    authors = [firstAuthor]
    //deal with multiple authors
    for (var i=2; i <= globals.authorCount; i++){
      firstTag = "#authorFirst" + i
      middleTag = "#authorMiddle" + i
      lastTag = "#authorLast" + i
      author = {
        'first' : $(firstTag).val(),
        'middle' : $(middleTag).val(),
        'last' : $(lastTag).val()
      }
      //check that there is really stuff in there
      if ((author['first'] == "") || (author['last'] == "")){
        console.log("Invalid author #" + i)
      }else{
        authors.push(author)
      }

    }
    refs = []
    for (var i = 1; i <= globals.refCount; i++){
      tag = '#ref' + i
      ref = $(tag).val()
      refs.push(ref)
    }
    var resourceCreationDate = $("#resourceCreationDate").val()
    console.log(resourceCreationDate)
    var resourceCategory = $("#resourceCategory option:selected").text()
    var tags = $("#tags").val()
    var ref = $("#ref").val()
    var resourceDescription = $("#resourceDesc").val()
    var notes =$("#notes").val()
    var uploaderName = $("#uploaderName").val()
    var uploaderEmail = $("#uploaderEmail").val()
    var resourceFilename = ""
    var link = $("#link").val()
    var resourcetype = $('input[name="resourcetype"]:checked').val();
    //format a metadata object to accompany the file
    var tagList = tags.split(",")
    var metadata = {
      resourceID: resourceID,
      resourceName: resourceName,
      authors: authors,
      creationDate: resourceCreationDate,
      resourceCategory: resourceCategory,
      tags: tagList,
      references: refs,
      resourceDescription: resourceDescription,
      notes: notes,
      uploader: {
        name: uploaderName,
        email: uploaderEmail
      },
      resourceFilename: resourceFilename,
      link: link,
      typeOfResource: resourcetype
    }
    //do form validation
    if ($("#resourceID").hasClass('invalid') || ($("#resourceID").val() == "")){
      $("#resourceID").addClass("invalid").removeClass("valid")
      alert("Please enter a valid ResourceID String.")
      return
    }

    // if ($("#fileUpload").get(0).files.length == 0){
    //   $("#fileUpload").addClass("invalid").removeClass("valid")
    //   alert("Please specify a file.")
    //   return
    // }

    if($("#authorLast").hasClass("invalid")|| ($("#resourceID").val() == "")){
      $("#authorLast").addClass("invalid").removeClass("valid")
      alert("Please enter a valid author name.")
      return
    }
    if ($("#uploaderName").hasClass("invalid") || ($("#uploaderName").val() == "")){
      $("#uploaderName").addClass("invalid").removeClass("valid")
      alert("Please enter your name as the uploader.")
      return
    }
    if ($("#uploaderEmail").hasClass("invalid") || ($("#uploaderEmail").val() == "")){
      $("#uploaderEmail").addClass("invalid").removeClass("valid")
      alert("Please enter your email, so we can contact you about this submission if we have any questions.")
      return
    }
    confirmString = ""
    doConfirm = false
    if ($("#resourceName").val() == ""){
      doConfirm = true;
      confirmString += '-- Resource Name\n'
      $("#resourceName").addClass('check').removeClass("invalid").removeClass('valid')
    }
    if ($("#resourceDescription").val() == ""){
      doConfirm = true;
      confirmString += "-- Resource Description\n"
      $("#resourceDescription").addClass('check').removeClass("invalid").removeClass('valid')
    }
    if ($("#tags").val() == ""){
      doConfirm = true;
      confirmString += "-- Tags\n"
      $("#tags").addClass('check').removeClass("invalid").removeClass('valid')
    }
    if ($("#ref1").val() == ""){
      doConfirm = true;
      confirmString += "-- Reference\n"
      $("#ref1").addClass('check').removeClass("invalid").removeClass('valid')
    }

    if (doConfirm){
      s = "It looks like this submission is missing the following:\n"
      s += confirmString
      s += "Are you sure you want to continue?"
      c = confirm(s)
    }else{
      c = true
    }
    console.log(c)
    if (c){
      //deal with the file upload
      var files = $("#fileUpload").get(0).files;
      //only upload if there is a file present, otherwise we'll have random metadata and no one wants that
      if (files.length > 0){
        var formData = new FormData();
        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          if (globals.mediaChecklist.indexOf(file.type) == -1){
            $('#fileUpload').addClass("invalid")
            $("#file-error").show();
            return
          }
          metadata['resourceMimeType'] = file.type
          metadata['resourceSize'] = file.size
          metadata['resourceFilename'] = file.name
          var metastring = JSON.stringify(metadata)
          // add the files to formData object for the data payload
          formData.append('uploads[]', file, file.name);
          formData.append('metadata', metastring)
        }
        $.ajax({
          url: globals.hosts.upload,
          type: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          success: function(data){
              if (data['success']){
                console.log("Upload successful.")
                window.location.href = "uploadComplete.html"
              }
          },
          error: function(xhr, status, error){
            window.location.href =  '500.html'
          }
        });
      }else{
        alert("Sorry, you need to upload a file.  I know this is inconvenient, and I'm working on fixing it.")
      }
    }
  }

  function getAllowedMediaTypes(){
    //get the list of media types that we are allowed to upload to the server
    $.getJSON(globals.hosts.mediaTypes, function(data){
      globals.mediaTypes = data['data']
      globals.mediaChecklist = []
      for (var i=0; i<globals.mediaTypes.length; i++){
        mime = globals.mediaTypes[i]['mimetype']
        globals.mediaChecklist.push(mime)
      }
    })
  }

  function resetTypes(){

    $("input[name=resourcetype]:checked").removeAttr("checked"); //uncheck checked resource type
    $(".resource-type").show();
    //only show types that match the current category
    $(".resource-type li, .changefields").hide();
    var cat = $("#resourceCategory").val();
    if (cat != null){ $("#resourceCategory").removeAttr("style"); }; //remove red border
    $("."+cat).slideDown(200);
    $(".resource-type li:visible").length > 0 ? $('.type-placeholder').hide() : $('.type-placeholder').show();
  };

  function applyTypes(e){
    console.log(e.target.value);
    var typechange = {
      dateheader: {
        journal: "Preprint Date",
        chapter: "Preprint Date",
        conference: "Presentation Date",
        slides: "Presentation Date",
        poster: "Presentation Date",
        thesis: "Submission Date",
        "research-other": "Date",
        project: "Project Date",
        tutorial: "Publication Date",
        "education-other": "Date",
        map: "Map Date",
        interactive: "Date",
        video: "Date",
        dataset: "Compilation Date",
        "production-other": "Date",
        blog: "Date of Post",
        news: "Article Date",
        "map-chat-other": "Date"
      },
      shorttitlelabel: {
        journal: "Format: Author et al. (YYYY) Abbreviated Outlet; e.g., <em>Kelly (2017) CP</em>",
        chapter: "Format: Author et al. (YYYY) Abbreviated Outlet; e.g., <em>Roth (2017) GIS&T BoK</em>",
        conference: "Format: Author et al. (YYYY) Abbreviated Outlet; e.g., <em>Nestel (2017) ICC</em>",
        slides: "Format: Author et al. (YYYY) Abbreviated Outlet; e.g., <em>Sack et al. (2017) NACIS Slides</em>",
        poster: "Format: Author et al. (YYYY) Abbreviated Outlet; e.g., <em>Sack et al. (2017) NACIS Poster</em>",
        thesis: "Format: Author (YYYY) Type; e.g., <em>Sack (2013) Thesis</em>",
        "research-other": "Format: Author (YYYY) Type",
        project: "Format: Author (YYYY) Type",
        tutorial: "Format: Author (YYYY) Type",
        "education-other": "Format: Author (YYYY) Type",
        map: "Format: Author (YYYY) Abbreviated Title",
        interactive: "Format: Author (YYYY) Type",
        video: "Format: Author (YYYY) Type",
        dataset: "Format: Author (YYYY) Type",
        "production-other": "Format: Author (YYYY) Type",
        blog: "Format: Author (YYYY) Abbreviated Outlet",
        news: "Format: Author (YYYY) Abbreviated Outlet",
        "map-chat-other": "Format: Author (YYYY) Abbreviated Outlet"
      },
      fulltitleheader: {
        journal: "Full Article Title",
        chapter: "Full Book Section Title",
        conference: "Full Proceedings Paper Title",
        slides: "Full Presentation Title",
        poster: "Full Poster Title",
        thesis: "Full Document Title",
        "research-other": "Full Title",
        project: "Full Title",
        tutorial: "Full Title",
        "education-other": "Full Title",
        map: "Full Title",
        interactive: "Full Title",
        video: "Full Title",
        dataset: "Full Title",
        "production-other": "Full Title",
        blog: "Full Blog Post Title",
        news: "Full Headline",
        "map-chat-other": "Full Title"
      },
      outletheader: {
        journal: "Journal",
        chapter: "Book Title",
        conference: "Conference",
        slides: "Conference or Meeting",
        poster: "Conference",
        thesis: "Degree",
        "research-other": "Publication Outlet",
        project: "Class",
        tutorial: "Publication Outlet",
        "education-other": "Publication Outlet",
        map: "Publication Outlet",
        interactive: "Publication Outlet",
        video: "Publication Outlet",
        dataset: "Publication Outlet",
        "production-other": "Publication Outlet",
        blog: "Blog Name",
        news: "News Outlet",
        "map-chat-other": "Publication Outlet"
      },
      outletlabel: {
        journal: "Full journal name, e.g., <em>Cartographic Perspectives</em>",
        chapter: "Complete book title only; No author, year, outlet",
        conference: "Full conference name, e.g., <em>American Association of Geographers</em>",
        slides: "Full conference name, e.g., <em>American Association of Geographers</em>",
        poster: "Full conference name, e.g., <em>American Association of Geographers</em>",
        thesis: "e.g., <em>GIS Certificate, B.S., M.S., Ph.D.</em>",
        "research-other": "Full outlet name",
        project: "",
        tutorial: "Full outlet name",
        "education-other": "Full outlet name",
        map: "Full outlet name, e.g., <em>Atlas of Design</em>",
        interactive: "Full outlet name, e.g., <em>bl.ocks.org</em>",
        video: "Full outlet name, e.g., <em>Cartography YouTube Channel</em>",
        dataset: "Full outlet name, e.g., <em>ArcGIS Online</em>",
        "production-other": "Full outlet name",
        blog: "Full blog name, e.g., <em>Something About Maps</em>",
        news: "Full news outlet name, e.g., <em>The New York Times</em>",
        "map-chat-other": "Full outlet name"
      }
    };
    for (var el in typechange){
      $(".typechange."+el).html(typechange[el][e.target.value]);
    }
  }

  function getCategories(populate){
    //populate the dropdown menu
    $("#resourceCategory").empty()
    var html = "<option selected='true' disabled='disabled'>Pick a Category</option>"
    $("#resourceCategory").append(html)
      .css({
        border: "1px solid #f00",
        "border-radius": "5px"
      });

    $.getJSON(globals.hosts.categories, function(data){
      globals.categories = data;
      if (populate){
        categoryData = data['data'].sort(function(a, b){
          return a.categoryid - b.categoryid;
        });
        for (var i = 0; i < categoryData.length; i++){
          var txt = categoryData[i]['categorytext'].replace(/ /g, '-');
          var html = "<option value='" + txt + "'>" + categoryData[i]['categorytext'] + "</option>"
          $("#resourceCategory").append(html);
        }
      }
    });

    resetTypes();
  }

  function setDate(){
    var now = new Date();

    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);

    var today = now.getFullYear()+"-"+(month)+"-"+(day) ;

    $('#resourceCreationDate').val(today);
  }

$("#fileUpload").change(function(){
  var files = $("#fileUpload").get(0).files;
  var file = files[0]
  console.log(globals.mediaChecklist.indexOf(file.type))
  if (globals.mediaChecklist.indexOf(file.type) == -1){
    $('#fileUpload').addClass("invalid").removeClass('valid')
    $("#file-error").show();
  }else{
    $("#fileUpload").removeClass("invalid").addClass('valid')
    $("#file-error").hide();
  }
});

$("#resourceCategory").change(resetTypes);
$("input[name=resourcetype]").on("input", applyTypes);

//do all of the form validation
$("#resourceID").on("input", function(){
  //check to see if there is whitespace
  input = $(this)
  s = input.val()
  if (hasWhiteSpace(s)){
    input.removeClass('valid').addClass('invalid')
  }else{
    input.addClass("valid").removeClass('invalid')
  }
})

$("#resourceName").on('input', function(){
  //just check existance
  input = $(this)
  s = input.val()
  if (!s){
    input.removeClass('valid').addClass('invalid')
  }else{
    input.addClass("valid").removeClass('invalid')
  }
})

$("#authorLast").on("input", function(){
  //just check to make sure there is at least one name associated with this resourceID
  input = $(this)
  s = input.val()
  if (!s){
    input.removeClass('valid').addClass('invalid')
  }else{
    input.addClass("valid").removeClass('invalid')
  }
})

$("#uploaderName").on('input', function(){
  input = $(this)
  s = input.val()
  if (!s){
    input.removeClass('valid').addClass('invalid')
  }else{
    input.addClass("valid").removeClass('invalid')
  }
})


// Email must be an email
$('#uploaderEmail').on('input', function() {
	var input=$(this);
	var re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
	var is_email=re.test(input.val());
	if(is_email){input.removeClass("invalid").addClass("valid");}
	else{input.removeClass("valid").addClass("invalid");}
});



function hasWhiteSpace(s) {
  return s.indexOf(' ') >= 0;
}
  </script>
</body>
</html>
